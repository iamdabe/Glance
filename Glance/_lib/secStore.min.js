/* https://github.com/jas-/secStore.js GPL */
(function(e,t){"use strict";var n=n||function(){var t={encrypt:false,data:{},key:"secStore.js",passphrase:"",storage:"local"};var r=r||{init:function(e){e.passphrase=e.encrypt?e.passphrase||s.key(e):false}};var i=i||{quota:function(e){var t=/local|session/.test(e)?1024*1025*5:1024*4,n=o.total(e),r=t-n;return r>0},set:function(e,t){var n=false;if(!i.quota(e.storage))t("Browser storage quota has been exceeded.");e.data=e.encrypt?sjcl.encrypt(e.passphrase,i.fromJSON(e.data)):i.fromJSON(e.data);n=this[e.storage]?this[e.storage].set(e):this.local.set(e);if(!n){t("Error occured saving data")}else{t(null,"Successfully set data")}},get:function(e,t){var n=false;n=this[e.storage]?this[e.storage].get(e):this.local.get(e);n=sjcl.decrypt(e.passphrase,n);n=i.toJSON(n);if(n){t(null,n)}else{t("Error occured retrieving storage data")}},fromJSON:function(e){var t;try{t=JSON.stringify(e)}catch(n){t=e}return t},toJSON:function(e){var t;try{t=JSON.parse(e)}catch(n){t=e}return t},cookie:{set:function(e,t){var n=new Date;n.setTime(n.getTime()+30*24*60*60*1e3);document.cookie=e+"="+t+";expires="+n.toGMTString()+";path=/;domain="+this.domain();return true},get:function(e){var t,n,r,i=document.cookie.split(";");for(t=0;t<i.length;t++){n=i[t].substr(0,i[t].indexOf("="));r=i[t].substr(i[t].indexOf("=")+1);n=n.replace(/^\s+|\s+$/g,"");if(n==e){return unescape(r)}}return false},domain:function(){return location.hostname}},local:{set:function(t){try{e.localStorage.setItem(t.key,t.data);return true}catch(n){return false}},get:function(t){return e.localStorage.getItem(t.key)}},session:{set:function(t){try{e.sessionStorage.setItem(t.key,t.data);return true}catch(n){return false}},get:function(t){return e.sessionStorage.getItem(t.key)}}};var s=s||{key:function(){var e=s.muid(),t=s.salt(e);return sjcl.codec.hex.fromBits(sjcl.misc.pbkdf2(e,t,1e4,256))},muid:function(){var t=e.navigator.appName+e.navigator.appCodeName+e.navigator.product+e.navigator.productSub+e.navigator.appVersion+e.navigator.buildID+e.navigator.userAgent+e.navigator.language+e.navigator.platform+e.navigator.oscpu;return t.replace(/\s/,"")},salt:function(e){var t,n,r=[],i=s.iv(e);r[0]=sjcl.hash.sha256.hash(e),t=[],t=r[0],n;for(var o=1;o<3;o++){r[o]=sjcl.hash.sha256.hash(r[o-1].concat(i));n=t.concat(r[o])}return JSON.stringify(sjcl.codec.hex.fromBits(n))},iv:function(e){return encodeURI(e.replace(/-/gi,"").substring(16,Math.ceil(16*e.length)%e.length))}};var o=o||{total:function(t){var n="",r=e.storage+"Storage";for(var i in r){if(r.hasOwnProperty(i)){n+=r[i]}}return n?3+n.length*16/(8*1024):0},size:function(e){var t=0;if(/object/.test(typeof e)){for(var n in e){if(e.hasOwnProperty(e[n]))t++}}else if(/array/.test(typeof e)){t=e.length}return t},merge:function(e,t){e=e||{};for(var n in e){if(e.hasOwnProperty(n)){t[n]=/object/.test(typeof e[n])?this.merge(t[n],e[n]):e[n]}t[n]=e[n]}return t}};n.prototype.get=function(e,n){n=n||e;var s=o.merge(e,t);r.init(s);i.get(s,n)};n.prototype.set=function(e,n){n=n||e;var s=o.merge(e,t);r.init(s);i.set(s,n)}};e.secStore=n})(window)
